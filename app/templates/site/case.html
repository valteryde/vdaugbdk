{% extends "site/base.html" %}

{% block title %}Case - {{ project.body.projecttitle }}{% endblock %} 

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='case.css') }}" />
{% endblock %} 

{% block content %}

<section class="padded-section">
	<div class="project-title-header">
		<h1 class="project-title">{{ project.body.projecttitle }}</h1>

		<!-- Add navbar -->
		<a class="navbar-link" href="/">Home</a>
		<a class="navbar-link" href="/projects">Projects</a>
		<a class="navbar-link" href="/about">About</a>

	</div>
	<p class="project-subtitle">
		{{ project.body.projectsubtitle|safe }}
	</p>

     <div class="techstack-container">
		{% for tech in project.body.techstack %}
		<img src="/static/{{ project.head.folder }}/{{ tech.image }}" alt="{{ tech.name }}" />
		{% endfor %}
	</div>

</section>

<section class="history-section">
	<div class="history-container">
		<div class="history-timeline">
			<div class="timeline-line"></div>

			{% for item in project.body.history %}
			<div class="timeline-item">
				<div class="timeline-dot">
					<div class="canvas-container dual-canvas-dot">
						<!-- Small canvas for computation (hidden) -->
						<canvas class="compute-canvas" width="200" height="100"></canvas>

						<!-- Large canvas for display -->
						<canvas class="render-canvas" width="1000" height="1000"></canvas>
					</div>
				</div>
				<div class="timeline-content">
					<div class="timeline-date">{{ item.date }}</div>
					<h3>{{ item.title }}</h3>
					<p>{{ item.description|safe }}</p>

                    {% if item.features %}
					<ul class="timeline-features">
						{% for feature in item.features %}
						<li><i class="ph ph-{{ feature.icon }}" aria-hidden="true"></i> {{ feature.text }}</li>
						{% endfor %}
					</ul>
                    {% endif %}

				</div>
			</div>
			{% endfor %}
		</div>
	</div>
</section>

<section id="card-section">
	<h2 class="section-title">{{ project.body.cardstitle }}</h2>

	<div class="archive-grid">
		{% for card in project.body.cards %}
		<div
			class="archive-card"
			data-image="/static/{{ project.head.folder }}/{{ card.image }}"
			data-title="{{ card.title }}"
			data-description="{{ card.longdescription }}"
			data-keyfeatures="{{ card.keyfeatures | join(', ') }}"
		>
			<div class="card-content">
				<div class="card-header">
					<span class="card-classification">{{ card.category }}</span>
				</div>
				<div class="card-preview">
					<img src="/static/{{ project.head.folder }}/{{ card.image }}" alt="{{ card.title }}" />
				</div>
				<div class="card-footer">
					<h3>{{ card.title }}</h3>
					<p>{{ card.shortdescription }}</p>
				</div>
			</div>
		</div>
		{% endfor %}
	</div>

	<!-- Modal -->
	<div id="archive-modal" class="modal">
		<div class="modal-content">
			<div class="modal-header">
				<div class="modal-info">
					<span id="modal-classification" class="modal-classification"></span>
				</div>
				<span class="modal-close">Ã—</span>
			</div>
			<div class="modal-body">
				<div class="modal-image-container">
					<img id="modal-image" src="" alt="Screenshot" />
				</div>
				<div class="modal-details">
					<h2 id="modal-title"></h2>
					<p id="modal-description"></p>
					<div class="modal-meta">
						<ul class="modal-keyfeatures"></ul>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>

<script>
	// Archive Modal Functionality
	const modal = document.getElementById("archive-modal");
	const modalImage = document.getElementById("modal-image");
	const modalTitle = document.getElementById("modal-title");
	const modalDescription = document.getElementById("modal-description");
	const modalClassification = document.getElementById("modal-classification");
	const modalClose = document.querySelector(".modal-close");

	// Add click event to all archive cards
	document.querySelectorAll(".archive-card").forEach((card) => {
		card.addEventListener("click", function () {
			const image = this.dataset.image;
			const title = this.dataset.title;
			const description = this.dataset.description;
			const classification = this.querySelector(".card-classification").textContent;

			modalImage.src = image;
			modalTitle.textContent = title;
			modalDescription.textContent = description;
			modalClassification.textContent = classification;
			modalSecurity.textContent = classification;

			// Add keyfeatures
			const keyFeatures = this.dataset.keyfeatures.split(",");
			const keyFeaturesList = modal.querySelector(".modal-keyfeatures");
			keyFeaturesList.innerHTML = "";
			keyFeatures.forEach((feature) => {
				const li = document.createElement("li");
				li.textContent = feature.trim();
				keyFeaturesList.appendChild(li);
			});

			modal.style.display = "block";
			document.body.style.overflow = "hidden";
		});
	});

	// Close modal when clicking the close button
	modalClose.addEventListener("click", function () {
		modal.style.display = "none";
		document.body.style.overflow = "auto";
	});

	// Close modal when clicking outside the modal content
	modal.addEventListener("click", function (event) {
		if (event.target === modal) {
			modal.style.display = "none";
			document.body.style.overflow = "auto";
		}
	});

	// Close modal with Escape key
	document.addEventListener("keydown", function (event) {
		if (event.key === "Escape" && modal.style.display === "block") {
			modal.style.display = "none";
			document.body.style.overflow = "auto";
		}
	});
</script>

<script>
	var dualCanvas = document.querySelectorAll(".dual-canvas-dot");

    var c = 0;
	dualCanvas.forEach((dualCanvas) => {
		// Generate ring parameters once
		c++
        let numRings = c + 1;
		let ringsParams = [];
		for (let i = 0; i < numRings; i++) {
			let cx = Math.random() * 2 - 1; // center x in [-1,1]
			let cy = Math.random() * 2 - 1; // center y in [-1,1]
			let r = 0.2 + Math.random() * 0.3; // radius
			ringsParams.push({ cx, cy, r });
		}

		var g = (x, y) => {
			// Use precomputed rings
			let rings = 0;
			for (let i = 0; i < ringsParams.length; i++) {
				let { cx, cy, r } = ringsParams[i];
				rings += Math.exp(-((x - cx) ** 2 + (y - cy) ** 2) / (2 * r * r));
			}
			// Subtract a threshold to get contours
			return rings - 1.5;
		};

		zValues = [];
		for (let i = 0; i < 8; i++) {
			let v = Math.random() * 3 - 1.5;

			zValues.push([v, 0.1]);
		}
		zValues = [
			// [-0.654469556461555, 0.1],
			[0.8686221839112336, 0.1],
			// [1.362943843276144, 0.1],
			[-0.1226648555261507, 0.1],
			[-0.8198134830914117, 0.1],
			[1.4039532561070849, 0.1],
			// [-0.5287341651581493, 0.1],
			[-0.894512332237768, 0.1],
		];
		drawDualCanvas(dualCanvas, g, [-2, 2, -2, 2], zValues, -2.5, 2.5, colorgradient_accent);
	});
</script>

{% endblock %}
